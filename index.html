<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>acer.fyi | MBTA 3D</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>

    <script src='https://unpkg.com/leaflet.marker.slideto@0.2.0/Leaflet.Marker.SlideTo.js'></script>

    <script src="leaflet-svg-shape-markers.min.js"></script>

    <link rel="stylesheet" href="global.css">
</head>
<body>
    <div id="map"></div>
</body>

<script>
    const map = L.map('map').setView([42.3321, -71.0889], 12);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}@2x.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    const redLine=[[-71.1406673,42.3961391],[-71.1395108,42.3961193],[-71.1384779,42.3964442],[-71.1376192,42.3970424],[-71.1367444,42.397593],[-71.1360359,42.3978743],[-71.1353275,42.3980129],[-71.1347586,42.3979931],[-71.1308783,42.3977198],[-71.1274864,42.3975296],[-71.1249586,42.3973553],[-71.123413,42.3969988],[-71.1208744,42.3964125],[-71.1202089,42.3961154],[-71.1197581,42.3957588],[-71.119522,42.3954419],[-71.1193288,42.3949229],[-71.1192107,42.3941821],[-71.1190121,42.3924468],[-71.1188511,42.3904064],[-71.1188994,42.3897328],[-71.1190121,42.3886037],[-71.1191087,42.3874546],[-71.1192965,42.385735],[-71.1194898,42.3838965],[-71.1197259,42.3816379],[-71.120225,42.3787848],[-71.1203807,42.3777783],[-71.1202948,42.3774929],[-71.1200917,42.37695],[-71.1197689,42.3765815],[-71.119259,42.3761258],[-71.1190336,42.375884],[-71.1188619,42.3755828],[-71.1188243,42.375032],[-71.118776,42.3741879],[-71.1187706,42.3735578],[-71.1185667,42.37332],[-71.1179119,42.3730941],[-71.1163394,42.37267],[-71.1160402,42.3725313],[-71.1148649,42.3715881],[-71.1137647,42.3707201],[-71.1126913,42.3698839],[-71.1118648,42.3695866],[-71.1097341,42.3687583],[-71.1087627,42.3683461],[-71.1076464,42.3677912],[-71.1065891,42.3671412],[-71.1048878,42.366083],[-71.1034226,42.3652308],[-71.1009074,42.3637247],[-71.1003117,42.3635106],[-71.0996006,42.3634274],[-71.0980871,42.3632986],[-71.095943,42.3631261],[-71.093866,42.3629755],[-71.0915046,42.362809],[-71.089178,42.3626584],[-71.0874714,42.3625217],[-71.0851851,42.3623433],[-71.083889,42.3622046],[-71.082083,42.3620262],[-71.0804219,42.3619013],[-71.0780444,42.361715],[-71.075954,42.3615644],[-71.0738314,42.361394],[-71.0714377,42.3612077],[-71.0708393,42.361166],[-71.0705146,42.3611403],[-71.0701094,42.3610452],[-71.0696184,42.3608767],[-71.0691112,42.3605754],[-71.0684001,42.3600245],[-71.0675248,42.3593744],[-71.0665588,42.3586569],[-71.0652922,42.3577808],[-71.064251,42.3571704],[-71.063293,42.3567641],[-71.0626222,42.3564271],[-71.0616722,42.3560188],[-71.0605613,42.3554737],[-71.0596945,42.3548513],[-71.0583582,42.3538781],[-71.0570942,42.3532835],[-71.0562436,42.3529961],[-71.0552266,42.3526214],[-71.0533481,42.3517116],[-71.0528651,42.3512438],[-71.0526826,42.350659],[-71.0527014,42.3503835],[-71.0529671,42.3498443],[-71.0533133,42.3493071],[-71.0537453,42.3486351],[-71.0542605,42.3479017],[-71.054977,42.346855],[-71.0554627,42.3461235],[-71.0563268,42.3448171],[-71.0571103,42.3434829],[-71.0571962,42.342898],[-71.0571801,42.3417958],[-71.0571533,42.3406162],[-71.0571399,42.3392601],[-71.0570916,42.3381022],[-71.057062,42.3366906],[-71.0570728,42.3349854],[-71.0570486,42.3334884],[-71.0570191,42.3317832],[-71.0570191,42.330885],[-71.0571694,42.3299808],[-71.0573384,42.3291717],[-71.0576792,42.3284876],[-71.0579637,42.327859],[-71.0579073,42.3273613],[-71.0577812,42.3271115],[-71.0575155,42.3267743],[-71.0571399,42.3264868],[-71.0565093,42.3259851],[-71.0561524,42.3256797]];
    const braintree=[[-71.0564589,42.3259197],[-71.0553855,42.325184],[-71.0542128,42.3243451],[-71.0533729,42.3236748],[-71.0530338,42.3232366],[-71.0527584,42.3226139],[-71.0526135,42.3221677],[-71.0525179,42.3218781],[-71.0523257,42.3209242],[-71.0523542,42.3202301],[-71.05222,42.3194804],[-71.0521583,42.3185186],[-71.0521476,42.3176519],[-71.0520859,42.3166126],[-71.0520698,42.3156844],[-71.052059,42.3146689],[-71.0522227,42.3137348],[-71.0525179,42.312864],[-71.0528882,42.3119358],[-71.0532505,42.3110333],[-71.0536932,42.3099364],[-71.0540582,42.3088772],[-71.0543802,42.3078477],[-71.0547049,42.3065663],[-71.0551763,42.3047552],[-71.0555359,42.3031524],[-71.0555976,42.3029282],[-71.0555788,42.3023549],[-71.055501,42.3017657],[-71.0553615,42.3012956],[-71.0549858,42.3005397],[-71.0542478,42.2996847],[-71.0532388,42.2987463],[-71.0521397,42.2977563],[-71.0509832,42.2967346],[-71.0498212,42.295697],[-71.0484392,42.2944828],[-71.047352,42.2934888],[-71.0460908,42.2923599],[-71.0441426,42.2906079],[-71.0428063,42.2894829],[-71.0414377,42.2882527],[-71.0402516,42.2871931],[-71.0388991,42.2860025],[-71.0377533,42.2849608],[-71.0367873,42.2840996],[-71.0352362,42.2826986],[-71.0338918,42.2814921],[-71.0331163,42.2805614],[-71.0328131,42.2799502],[-71.0326118,42.2794977],[-71.032322,42.2787059],[-71.0317451,42.2774278],[-71.031466,42.2770706],[-71.0308166,42.2764098],[-71.0303067,42.2759196],[-71.0293568,42.2750126],[-71.028211,42.273931],[-71.0267887,42.2725853],[-71.0252484,42.2711305],[-71.0238584,42.2698087],[-71.0231822,42.2691993],[-71.0219505,42.2680878],[-71.0207536,42.2670239],[-71.0201633,42.2664821],[-71.0192133,42.2654856],[-71.0182822,42.2645944],[-71.0176543,42.263985],[-71.0164601,42.2628734],[-71.0153358,42.2617936],[-71.0142436,42.2607435],[-71.0131353,42.2597013],[-71.0121398,42.2587683],[-71.0108302,42.2575633],[-71.0095905,42.2563821],[-71.008281,42.2551254],[-71.0069178,42.253837],[-71.0060456,42.2528682],[-71.0056243,42.2521773],[-71.0049615,42.2510873],[-71.0038191,42.2491416],[-71.0036205,42.2486214],[-71.0034863,42.2479821],[-71.0034917,42.2475016],[-71.003701,42.2463698],[-71.0041196,42.244289],[-71.0046856,42.242065],[-71.0055496,42.2388124],[-71.0064345,42.2353055],[-71.0069551,42.2327873],[-71.0070571,42.2319135],[-71.0070785,42.2313693],[-71.0069175,42.2304558],[-71.0060159,42.2284061],[-71.004175,42.2255779],[-71.0019263,42.2221893],[-71.0009712,42.2208943],[-71.000558,42.2200242],[-71.0002496,42.2189218],[-71.0001144,42.2178591],[-71.0005107,42.2145496],[-71.0013265,42.208987],[-71.0019672,42.2056811],[-71.0021361,42.2041234]];
    const ashmont=[[-71.0564531,42.3259177],[-71.055581,42.3251879],[-71.0543417,42.3242579],[-71.0532768,42.3230759],[-71.0528034,42.3222311],[-71.0525726,42.3215093],[-71.0525136,42.3208469],[-71.0523687,42.3199505],[-71.0522882,42.3188756],[-71.0522131,42.3173683],[-71.052154,42.3161029],[-71.0521218,42.3148217],[-71.0522238,42.3141394],[-71.0524814,42.3131913],[-71.0530932,42.3117037],[-71.0538155,42.3101328],[-71.0542234,42.3091489],[-71.054632,42.3076811],[-71.0551686,42.3055546],[-71.0556087,42.3039518],[-71.055759,42.3030552],[-71.0558019,42.3023251],[-71.0557805,42.3018411],[-71.0559307,42.301246],[-71.0562313,42.3009444],[-71.0570471,42.3004921],[-71.0577464,42.3003651],[-71.0587228,42.3003017],[-71.0593558,42.3003017],[-71.0602357,42.300262],[-71.0607288,42.3002223],[-71.061405,42.3001033],[-71.0627789,42.2997224],[-71.0635625,42.299524],[-71.064228,42.2991986],[-71.0649471,42.2987939],[-71.0657522,42.2980162],[-71.0661601,42.2973734],[-71.0664261,42.2965164],[-71.0664778,42.2956117],[-71.0661236,42.2943657],[-71.0656943,42.2926039],[-71.0650502,42.2896436],[-71.0643847,42.2861831],[-71.0641271,42.2851671],[-71.0634509,42.2839289],[-71.0626888,42.2825716],[-71.0623775,42.2819683]];
    const mattapan=[[-71.0634214,42.2839309],[-71.0629733,42.2835975],[-71.0627721,42.2832741],[-71.062077,42.2821866],[-71.0605167,42.2797855],[-71.0597429,42.2784638],[-71.0592223,42.2770389],[-71.0588547,42.2758263],[-71.0588976,42.2753262],[-71.0591112,42.274832],[-71.0596156,42.2743636],[-71.0611506,42.2733157],[-71.0631363,42.271982],[-71.0645532,42.2710611],[-71.065487,42.2707276],[-71.0662921,42.2704498],[-71.0677411,42.2703148],[-71.0701884,42.2702751],[-71.0713827,42.2702513],[-71.0727968,42.2700846],[-71.074965,42.2698384],[-71.0784194,42.2690842],[-71.0835146,42.2678219],[-71.0850603,42.2674487],[-71.085758,42.2673931],[-71.0865737,42.2674408],[-71.0878618,42.267679],[-71.0890211,42.2679092],[-71.0898368,42.2679092],[-71.0918118,42.2676075],[-71.0924022,42.2675122]];
    const redLinePolyline = L.polyline(redLine.map(([lat, lng]) => [lng, lat]), {color: 'red'})
    const braintreePolyline = L.polyline(braintree.map(([lat, lng]) => [lng, lat]), {color: 'red'})
    const ashmontPolyline = L.polyline(ashmont.map(([lat, lng]) => [lng, lat]), {color: 'red'})
    const mattapanPolyline = L.polyline(mattapan.map(([lat, lng]) => [lng, lat]), {color: 'red'})
    const redLineLayer = L.layerGroup([redLinePolyline, braintreePolyline, ashmontPolyline, mattapanPolyline]).addTo(map);

    const orangeLine=[[-71.1141195,42.3006984],[-71.1127939,42.3025354],[-71.1095816,42.3073875],[-71.1076388,42.3104343],[-71.1061468,42.3129017],[-71.1051592,42.315139],[-71.1046011,42.316567],[-71.1034955,42.3184868],[-71.1029803,42.3192325],[-71.1011341,42.3212792],[-71.1001895,42.3225405],[-71.0992556,42.3240477],[-71.0987619,42.3251185],[-71.0974524,42.3282993],[-71.0961321,42.3303456],[-71.0948226,42.3318367],[-71.0935023,42.3330978],[-71.0925255,42.333883],[-71.0907223,42.3353661],[-71.0892517,42.336635],[-71.0873304,42.3380546],[-71.0850548,42.3399738],[-71.0847543,42.3402038],[-71.0828114,42.341774],[-71.0825002,42.3421229],[-71.0807828,42.3435265],[-71.0785823,42.3453662],[-71.0767683,42.3467856],[-71.0757486,42.3473882],[-71.0747074,42.3473962],[-71.0729256,42.3475151],[-71.0703924,42.3475785],[-71.0682993,42.34742],[-71.0665733,42.3475349],[-71.0652531,42.3481534],[-71.0646037,42.3488631],[-71.0635947,42.3499097],[-71.0632611,42.3504925],[-71.0629089,42.3512339],[-71.0626298,42.3525501],[-71.0625332,42.3532795],[-71.0619536,42.3540644],[-71.06117,42.3549128],[-71.0605153,42.3554123],[-71.0593611,42.3564588],[-71.0586592,42.3570534],[-71.0579508,42.3578145],[-71.0578327,42.3581554],[-71.0577952,42.3588055],[-71.0576825,42.3599511],[-71.0577147,42.3608945],[-71.0578113,42.3622065],[-71.0579508,42.3629359],[-71.0581601,42.3634393],[-71.0588203,42.3640972],[-71.0602371,42.3653299],[-71.0617399,42.3668638],[-71.0630816,42.3683659],[-71.0651264,42.3707162],[-71.0660387,42.3715683],[-71.0678152,42.3726304],[-71.0686846,42.3731337],[-71.0697097,42.3735538],[-71.0715398,42.3744772],[-71.0723127,42.3749329],[-71.0738744,42.3761575],[-71.0746043,42.3769381],[-71.0756248,42.3782538],[-71.0764737,42.3791731],[-71.0768816,42.3801678],[-71.0769675,42.3809048],[-71.0769191,42.3820302],[-71.0769406,42.3837459],[-71.0769299,42.3858658],[-71.0769675,42.3880371],[-71.0769928,42.3901607],[-71.0770948,42.3924428],[-71.0773041,42.393873],[-71.0772236,42.39522],[-71.0771806,42.3968403],[-71.0772021,42.3988211],[-71.0771968,42.3996847],[-71.0771849,42.4016891],[-71.0769809,42.4040738],[-71.0769165,42.4091517],[-71.0767662,42.4132154],[-71.0768557,42.4176273],[-71.076684,42.4191797],[-71.0765648,42.4204786],[-71.0761687,42.4216508],[-71.0755676,42.4234248],[-71.0742796,42.4264026],[-71.0726051,42.4307423],[-71.0715317,42.433213],[-71.0710594,42.4353351],[-71.0708018,42.4374572],[-71.0707804,42.4376987]]
    const orangeLinePolyline = L.polyline(orangeLine.map(([lat, lng]) => [lng, lat]), {color: 'orange'})
    const orangeLineLayer = L.layerGroup([orangeLinePolyline]).addTo(map);

    const blueLine=[[-71.0621012,42.3613801],[-71.0609232,42.3609084],[-71.060365,42.3605953],[-71.0601235,42.3602187],[-71.0597263,42.3596915],[-71.0594999,42.3596142],[-71.0594033,42.3593843],[-71.0593066,42.3592614],[-71.0589793,42.3591068],[-71.0578307,42.3587976],[-71.0568271,42.358869],[-71.0559845,42.3589562],[-71.0545033,42.3592138],[-71.0541061,42.3592416],[-71.0531562,42.35942],[-71.0522277,42.3595468],[-71.0505318,42.3597807],[-71.0483313,42.3602048],[-71.0474082,42.3605972],[-71.0463456,42.3611601],[-71.0454869,42.3617943],[-71.0449609,42.3623572],[-71.0444886,42.3629557],[-71.0440593,42.3634987],[-71.0422828,42.3657223],[-71.0410558,42.3672562],[-71.0402866,42.3681836],[-71.0395621,42.3690873],[-71.0386282,42.3700741],[-71.0375495,42.3709143],[-71.0368142,42.3714613],[-71.0360843,42.3717545],[-71.0351881,42.3719289],[-71.0335512,42.3722499],[-71.0327569,42.3724322],[-71.0321343,42.3727334],[-71.0313293,42.3733873],[-71.0302827,42.3743068],[-71.0291664,42.3753173],[-71.0280662,42.3762486],[-71.0264615,42.377596],[-71.0258872,42.3780636],[-71.0247655,42.3789195],[-71.0229945,42.3795694],[-71.0219908,42.3799617],[-71.0210248,42.3802312],[-71.0190068,42.3802153],[-71.0177456,42.3802827],[-71.0169567,42.3804808],[-71.0159048,42.3810197],[-71.0150139,42.3816656],[-71.0119166,42.3839599],[-71.0108593,42.3847484],[-71.010226,42.3850496],[-71.0073869,42.3860084],[-71.0053958,42.3866622],[-71.0038448,42.3871773],[-71.0014935,42.3879182],[-71.0003879,42.3883065],[-70.9997868,42.3886076],[-70.9983377,42.3894714],[-70.9972,42.3904539],[-70.996148,42.3917693],[-70.9941516,42.3948912],[-70.9921658,42.3978466],[-70.9915218,42.3993123],[-70.9914466,42.4001759],[-70.9915432,42.4012851],[-70.9920585,42.4048026],[-70.9925308,42.4079397],[-70.9927025,42.4092309],[-70.992719,42.4100152],[-70.9926059,42.4108232],[-70.992359,42.4119163],[-70.991672,42.4134609],[-70.9908348,42.4150768],[-70.9895468,42.4170411]];
    const blueLinePolyline = L.polyline(blueLine.map(([lat, lng]) => [lng, lat]), {color: 'blue'})
    const blueLineLayer = L.layerGroup([blueLinePolyline]).addTo(map);

    const greenLineE1=[[-71.1186425,42.4097221],[-71.1178616,42.4089398],[-71.1173115,42.4082863],[-71.1163267,42.4070921],[-71.1152327,42.4055711],[-71.1145242,42.4046877],[-71.1131074,42.402822],[-71.1118301,42.4010038],[-71.11044,42.3991459],[-71.1089856,42.397288],[-71.1078049,42.3956994],[-71.1067637,42.3942019]];
    const greenLineE2=[[-71.0792458,42.349549],[-71.0793907,42.3492754],[-71.0792136,42.3488908],[-71.079058,42.3485221],[-71.0792244,42.3479909],[-71.079482,42.3472376],[-71.0798577,42.346857],[-71.0810223,42.3459451],[-71.0826484,42.3446605],[-71.0864804,42.3414687],[-71.0868615,42.3411871],[-71.0889975,42.3403307],[-71.0922069,42.3390222],[-71.0958167,42.3375986],[-71.0985806,42.3365002],[-71.099976,42.3359649],[-71.1003249,42.3357864],[-71.1023858,42.3350727],[-71.1047687,42.3341685],[-71.1055845,42.3337997],[-71.1063519,42.3333754],[-71.1069369,42.3332485],[-71.1084772,42.3332525],[-71.1097384,42.3331652],[-71.1104737,42.3329313],[-71.1110426,42.3325942],[-71.1119496,42.3320073],[-71.112014,42.3317931],[-71.1117832,42.3312696],[-71.1112335,42.329957],[-71.1106968,42.3288228],[-71.1103157,42.3282755]];
    const greenLineD1=[[-71.106753,42.3942058],[-71.1054756,42.3925736],[-71.1048638,42.392011],[-71.1041983,42.3915593],[-71.1030552,42.3908501],[-71.1021267,42.3903826],[-71.1006347,42.389713],[-71.0977258,42.3884016],[-71.0953322,42.3873199],[-71.094613,42.3869792],[-71.0935289,42.3863571],[-71.09274,42.3857033],[-71.0914788,42.3843958],[-71.0905932,42.3834171],[-71.0882747,42.3810395],[-71.0866056,42.3794703],[-71.0850546,42.3778179],[-71.0832835,42.375991],[-71.08294,42.3756383],[-71.0822369,42.3753054],[-71.081668,42.3751945]];
    const greenLineD2=[[-71.1016384,42.3475944],[-71.1021214,42.3474358],[-71.1023066,42.3471642],[-71.1024622,42.3467023],[-71.1026334,42.346294],[-71.1038248,42.3456041],[-71.1080861,42.343019],[-71.1091483,42.3423529],[-71.1098787,42.3416947],[-71.1106086,42.3409413],[-71.1109521,42.3403941],[-71.1113063,42.3392283],[-71.1119396,42.3376502],[-71.1131179,42.3355009],[-71.1137643,42.3346761],[-71.1144728,42.3339861],[-71.1155998,42.3332247],[-71.1168342,42.3326457],[-71.118294,42.3320033],[-71.1193244,42.3316226],[-71.1205374,42.3314957],[-71.1232208,42.331464],[-71.124906,42.3311864],[-71.1269669,42.3313529],[-71.1312712,42.3317574],[-71.1331496,42.3320668],[-71.134545,42.3326299],[-71.1379476,42.3345968],[-71.1391498,42.3353264],[-71.1400944,42.3356833],[-71.1413609,42.3359213],[-71.1429495,42.3359926],[-71.1447421,42.3357547],[-71.146159,42.335493],[-71.148939,42.3350251],[-71.1507423,42.3343351],[-71.1524275,42.333304],[-71.1559887,42.3311784],[-71.1604754,42.3284262],[-71.1618923,42.3275933],[-71.1631589,42.327046],[-71.1647797,42.326697],[-71.1661935,42.326697],[-71.1674631,42.3268001],[-71.1703613,42.3273792],[-71.1752452,42.3283468],[-71.1820719,42.3296397],[-71.1849894,42.3301949],[-71.1860923,42.3303536],[-71.1875414,42.3303694],[-71.1893339,42.3302267],[-71.1908152,42.3300046],[-71.1928546,42.329259],[-71.1949155,42.3282279],[-71.1979961,42.3266811],[-71.2020386,42.3246188],[-71.2034811,42.3238811],[-71.2043505,42.3234527],[-71.2058747,42.322009],[-71.2077853,42.3202321],[-71.2089661,42.3189152],[-71.2096101,42.318471],[-71.2105225,42.3180902],[-71.2117247,42.3177491],[-71.2132287,42.3177094],[-71.2143875,42.3180188],[-71.2152775,42.3183361],[-71.2195496,42.3203669],[-71.2242725,42.3226595],[-71.2287914,42.3247695],[-71.2298541,42.325301],[-71.2319472,42.3267922],[-71.2333425,42.3277678],[-71.2342549,42.3283468],[-71.2357577,42.3290924],[-71.2382801,42.3303853],[-71.2414788,42.3319874],[-71.2433465,42.3328837],[-71.2471784,42.3347871],[-71.2517112,42.3370712],[-71.2526235,42.337436]];
    const greenLineMain=[[-71.0947807,42.377376],[-71.093337,42.3767341],[-71.0926742,42.3764586],[-71.0916303,42.3761832],[-71.0904873,42.3760287],[-71.0895079,42.3759118],[-71.0880186,42.3757314],[-71.0863173,42.3755432],[-71.0850829,42.3753669],[-71.0833413,42.3752083],[-71.0817956,42.3751053],[-71.0812346,42.3749091],[-71.0805908,42.374493],[-71.0803868,42.3739323],[-71.0802285,42.3735657],[-71.0795067,42.3730782],[-71.077786,42.3721073],[-71.0765396,42.3715009],[-71.0755977,42.370839],[-71.074688,42.3702049],[-71.0732174,42.3694777],[-71.0687465,42.3672126],[-71.0672169,42.3664516],[-71.0662348,42.366186],[-71.0646999,42.3657025],[-71.0641524,42.3656946],[-71.063283,42.3661345],[-71.0621828,42.3665903],[-71.0617534,42.3665705],[-71.0613724,42.3663803],[-71.0609699,42.3659007],[-71.0599341,42.3647631],[-71.0589197,42.3638951],[-71.0583884,42.3633481],[-71.05812,42.362706],[-71.0580288,42.3618974],[-71.0579912,42.3613583],[-71.0581361,42.3611165],[-71.0585709,42.3607716],[-71.059333,42.359745],[-71.0596925,42.3590275],[-71.0615327,42.3569305],[-71.0618601,42.3566372],[-71.0620723,42.3566174],[-71.0624855,42.3565381],[-71.0628209,42.3561774],[-71.0631591,42.3558364],[-71.0636736,42.355],[-71.0639446,42.3544073],[-71.0646396,42.3530575],[-71.0648167,42.3525818],[-71.0650688,42.3525302],[-71.0653588,42.3525283],[-71.0671294,42.3525976],[-71.0674621,42.3526095],[-71.0682725,42.3524946],[-71.0692493,42.3522567],[-71.0705857,42.3519633],[-71.0723621,42.3514361],[-71.0735965,42.3511308],[-71.0767308,42.3502428],[-71.0792522,42.3495609]];
    const greenLineB=[[-71.0792407,42.349547],[-71.0802631,42.3492992],[-71.0825673,42.3486807],[-71.0846792,42.3480999],[-71.0854225,42.3479433],[-71.0856694,42.3478977],[-71.0870513,42.347977],[-71.0881864,42.3480761],[-71.0886829,42.3481019],[-71.0901051,42.3480959],[-71.0915059,42.3480662],[-71.0919003,42.3481395],[-71.092437,42.3483913],[-71.093175,42.3488571],[-71.0935024,42.3489662],[-71.0938432,42.3489979],[-71.094243,42.3489741],[-71.0954291,42.3489285],[-71.0965695,42.3488829],[-71.096956,42.348877],[-71.0976295,42.3489384],[-71.098397,42.3490276],[-71.1015733,42.3493983],[-71.1047513,42.349763],[-71.1094639,42.3503538],[-71.1144176,42.3509365],[-71.1222924,42.3518959],[-71.1246822,42.3521457],[-71.1249076,42.3520466],[-71.1254282,42.3516422],[-71.1263406,42.3511149],[-71.1267377,42.3508969],[-71.1271993,42.3507106],[-71.1278809,42.3505996],[-71.1285356,42.350552],[-71.1296036,42.350667],[-71.1301457,42.3506828],[-71.1306448,42.3505718],[-71.1312781,42.3502943],[-71.1329204,42.349545],[-71.1351584,42.3484785],[-71.135577,42.3483199],[-71.1359312,42.3482803],[-71.1362118,42.3482565],[-71.1364947,42.3482803],[-71.1369402,42.3483834],[-71.1384966,42.3488948],[-71.1388508,42.3489741],[-71.1391728,42.34899],[-71.1394412,42.3489781],[-71.1396397,42.3489226],[-71.1399886,42.3488036],[-71.1402838,42.3485975],[-71.1404233,42.3483913],[-71.1405736,42.3480305],[-71.1406756,42.3475825],[-71.1407545,42.3470592],[-71.1410443,42.3463733],[-71.1419399,42.3450371],[-71.1430777,42.3433758],[-71.1436252,42.3427256],[-71.143872,42.342567],[-71.1442155,42.3422617],[-71.1447093,42.3420317],[-71.1453533,42.3417819],[-71.1459329,42.3416114],[-71.1467689,42.3415281],[-71.1474732,42.3415202],[-71.1478811,42.3415361],[-71.1484661,42.341548],[-71.149022,42.3414647],[-71.1494429,42.3413616],[-71.1500601,42.3411514],[-71.1509939,42.3406003],[-71.1514984,42.3401998],[-71.1518956,42.3398073],[-71.1525945,42.338701],[-71.1528884,42.3383401],[-71.1532265,42.3380864],[-71.1536666,42.3380546],[-71.1541127,42.3381736],[-71.1548581,42.3384234],[-71.1562642,42.3391134],[-71.1577562,42.3395971],[-71.1588994,42.3398667],[-71.1597562,42.3399857],[-71.1605041,42.3400214],[-71.161776,42.3400967],[-71.1632197,42.3401403],[-71.1646312,42.3400928],[-71.1660642,42.3399976],[-71.1664765,42.3400065],[-71.1665395,42.3400214],[-71.1666562,42.3400571],[-71.1670277,42.3402157]];
    const greenLineC=[[-71.0969584,42.3488869],[-71.0976561,42.3487223],[-71.0999209,42.3480622],[-71.1053127,42.3465874],[-71.1176995,42.3431459],[-71.1229805,42.3416867],[-71.1241827,42.341433],[-71.1256854,42.3409889],[-71.1267373,42.3406875],[-71.1280039,42.34018],[-71.1289056,42.3400214],[-71.1301446,42.3397676],[-71.1311811,42.3396249],[-71.1337143,42.3395614],[-71.134616,42.3395456],[-71.1352385,42.3393711],[-71.1357108,42.3391649],[-71.1392315,42.3383877],[-71.1422799,42.3377057],[-71.1456718,42.3370395],[-71.148527,42.3363575],[-71.1489937,42.3362266]];
    const greenLineE1PolyLine = L.polyline(greenLineE1.map(([lat, lng]) => [lng, lat]), {color: 'green'})
    const greenLineE2PolyLine = L.polyline(greenLineE2.map(([lat, lng]) => [lng, lat]), {color: 'green'})
    const greenLineD1PolyLine = L.polyline(greenLineD1.map(([lat, lng]) => [lng, lat]), {color: 'green'})
    const greenLineD2PolyLine = L.polyline(greenLineD2.map(([lat, lng]) => [lng, lat]), {color: 'green'})
    const greenLineMainPolyLine = L.polyline(greenLineMain.map(([lat, lng]) => [lng, lat]), {color: 'green'})
    const greenLineBPolyLine = L.polyline(greenLineB.map(([lat, lng]) => [lng, lat]), {color: 'green'})
    const greenLineCPolyLine = L.polyline(greenLineC.map(([lat, lng]) => [lng, lat]), {color: 'green'})
    const greenLineLayer = L.layerGroup([greenLineE1PolyLine, greenLineE2PolyLine, greenLineD1PolyLine, greenLineD2PolyLine, greenLineMainPolyLine, greenLineBPolyLine, greenLineCPolyLine]).addTo(map);

    const layerControl = L.control.layers({}, {"Blue Line": blueLineLayer, "Green Line": greenLineLayer, "Orange Line": orangeLineLayer, "Red Line": redLineLayer}).addTo(map);

    const lineLayers = {
        "Red": redLineLayer,
        "Orange": orangeLineLayer,
        "Blue": blueLineLayer,
        "Green-B": greenLineLayer,
        "Green-C": greenLineLayer,
        "Green-D": greenLineLayer,
        "Green-E":  greenLineLayer
    }

    const lineColors = {
        "Red": ["red", "darkred"],
        "Orange": ["orange", "darkorange"],
        "Blue": ["blue", "darkblue"],
        "Green-B": ["green", "darkgreen"],
        "Green-C": ["green", "darkgreen"],
        "Green-D": ["green", "darkgreen"],
        "Green-E":  ["green", "darkgreen"]
    }

    const trainMarkers = {}
    const evtSource = new EventSource("https://api-v3.mbta.com/vehicles?filter[route]=Red,Orange,Blue,Green-B,Green-C,Green-D,Green-E&api_key=b0f13f7a6f7e4ea292bfd81eef538234",)

    evtSource.addEventListener("reset", (e) => {
        trainData = JSON.parse(e.data)
        trainData.forEach((train) => {
            trainMarkers[train["id"]] = 
                L.shapeMarker([train["attributes"]["latitude"], train["attributes"]["longitude"]], 
                    {
                        shape: "arrowhead", 
                        rotation: train["attributes"]["bearing"], 
                        radius: 5, 
                        weight: 1, 
                        color: train["attributes"]["current_status"] == "STOPPED_AT" ? 
                            "black" : lineColors[train["relationships"]["route"]["data"]["id"]][1], 
                        fill: true, 
                        fillOpacity: 1, 
                        fillColor: lineColors[train["relationships"]["route"]["data"]["id"]][0]
                    }).addTo(lineLayers[train["relationships"]["route"]["data"]["id"]]);
        })
    });

    evtSource.addEventListener("add", (e) => {
        train = JSON.parse(e.data)
        trainMarkers[train["id"]] = 
                L.shapeMarker([train["attributes"]["latitude"], train["attributes"]["longitude"]], 
                    {
                        shape: "arrowhead", 
                        rotation: train["attributes"]["bearing"], 
                        radius: 5, 
                        weight: 1, 
                        color: train["attributes"]["current_status"] == "STOPPED_AT" ? 
                            "black" : lineColors[train["relationships"]["route"]["data"]["id"]][1], 
                        fill: true, 
                        fillOpacity: 1, 
                        fillColor: lineColors[train["relationships"]["route"]["data"]["id"]][0]
                    }).addTo(lineLayers[train["relationships"]["route"]["data"]["id"]]);
    });

    evtSource.addEventListener("update", (e) => {
        train = JSON.parse(e.data)
        trainMarkers[train["id"]].slideTo([train["attributes"]["latitude"], train["attributes"]["longitude"]], {
            duration: 5000
        })
        trainMarkers[train["id"]].setRotation(train["attributes"]["bearing"])
        trainMarkers[train["id"]].setStyle(
            {
                color: train["attributes"]["current_status"] == "STOPPED_AT" ? 
                    "black" : lineColors[train["relationships"]["route"]["data"]["id"]][1]
            })
    });

    evtSource.addEventListener("remove", (e) => {
        console.log(e.data);
    });

</script>
</html>